{% extends "layout.html" %}

{% block title %}Alchemy Barcode Scanner{% endblock %}
{% set active_page = 'scanner' %}

{% block extra_css %}
<style>
  /* Base & Layout */
  html, body { 
    height: 100%; 
    background-color: #F9FAFB; /* Light gray background for the page itself */
  }
  .page-content{
    min-height:100vh;
  }
  .scanner-content{ 
    max-width:900px; 
    margin: 56px auto; /* Center the content vertically and horizontally */
    border-radius:12px; 
    overflow:hidden;
    box-shadow:0 4px 12px rgba(0,0,0,.1);
  }

  /* UPDATED: Header with gradient */
  .page-header {
    background: linear-gradient(135deg, #E4DDFF 0%, #DDF5FF 100%);
    padding: 40px;
    border-bottom: 1px solid #DDE2FF; /* A soft border between header and main */
  }

  /* UPDATED: Main content area is now just white */
  .scanner-main{
    background:#fff; 
    padding:40px;
  }

  /* Typography */
  .page-title{ font-size:28px; color:#383F45; font-weight:600; margin-bottom:20px; }
  .instruction-text{ font-size:14px; color:#6B7280; line-height:1.6; }
  .section-title{ font-size:24px; color:#383F45; font-weight:600; margin-bottom:20px; padding-top:40px; }
  .section-title:first-of-type{ padding-top:0; }
  .form-label{ font-size:12px; font-weight:700; color:#424B52; margin-bottom:8px; display:block; text-transform:uppercase; }

  /* Inputs */
  .barcode-input-group{ display:flex; gap:10px; margin-bottom:8px; }
  .barcode-input{
    flex:1; padding:10px 16px; font-size:14px;
    border:1px solid #E1E4E8; border-radius:6px; transition:border-color .2s;
  }
  .barcode-input:focus{ outline:none; border-color:#0066FF; }

  .form-select{
    width: 100%; padding: 10px 16px; font-size: 14px;
    border: 1px solid #E1E4E8; border-radius: 6px; background-color: #fff;
    -webkit-appearance: none; appearance: none;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em;
    padding-right: 2.5rem;
  }
  .form-select:disabled { background-color:#F3F4F6; cursor:not-allowed; }

  /* Buttons */
  .btn{ border:none; border-radius:6px; padding:12px 24px; font-size:14px; font-weight:700; text-transform:uppercase; cursor:pointer; transition:background-color .2s, opacity .2s, border-color .2s; }
  .btn-primary{ background:#0066FF; color:#fff; }
  .btn-primary:hover:not(:disabled){ background:#0052CC; }
  .btn-primary:disabled{ background:#BFCFEF; cursor:not-allowed; opacity:.9; }
  .btn-outline{ background:transparent; color:#0066FF; border:1px solid #0066FF; }
  .btn-outline:hover{ background:#F0F7FF; }

  /* Table container */
  .scanned-table-container{
    background:#fff; 
    border-radius:8px; 
    margin-top:20px; 
    overflow:hidden; 
    box-shadow:0 2px 8px rgba(0,0,0,.06);
  }

  /* Table */
  .scanned-table{ width:100%; border-collapse:collapse; table-layout:fixed; }
  .scanned-table thead{ background:#F9FAFB; border-bottom: 1px solid #E5E7EB; }
  .scanned-table th, .scanned-table td { /* styles remain the same */ }
  
  /* Other styles remain the same */
  
</style>
{% endblock %}

{% block content %}
<div class="page-content">
  <div class="scanner-content">
    
    <div class="page-header">
      <h1 class="page-title">Barcode Scanning</h1>
      <p class="instruction-text">
        Before scanning, make sure the input field is active so the barcode is entered correctly. In case the scanner doesnâ€™t respond or fails to read the code, you can simply type the barcode manually instead. There's no limit to how many barcodes you can scan, so feel free to continue as needed.
      </p>
    </div>

    <div class="scanner-main">
      <h2 class="section-title">Barcode Overview</h2>

      <div class="form-group">
        <label class="form-label" for="barcode-input">Scan or Enter Barcode</label>
        <div class="barcode-input-group">
          <input type="text" id="barcode-input" class="barcode-input" placeholder="Enter barcode..." autofocus>
          <button id="add-barcode" class="btn btn-primary">Add</button>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Scanned Barcodes</label>
        <div class="scanned-table-container">
          <table class="scanned-table">
            <thead>
              <tr>
                </tr>
            </thead>
            <tbody id="scanned-items">
              </tbody>
          </table>
        </div>
      </div>

      <h2 class="section-title">Location</h2>
      <div class="form-group">
        <label class="form-label" for="location-select">Location</label>
        <select class="form-select" id="location-select">
          <option value="">-- Please Select --</option>
        </select>
      </div>
      <div class="form-group" style="margin-top:20px;">
        <label class="form-label" for="sublocation-select">Sublocation</label>
        <select class="form-select" id="sublocation-select" disabled>
          <option value="">-- Please Select --</option>
        </select>
      </div>

      <div class="button-group">
        <div id="update-wrapper" class="has-tooltip" data-tooltip="">
          <button id="update-button" class="btn btn-primary" disabled>Update Location</button>
        </div>
        <button id="reset-button" class="btn btn-outline">Reset</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  const barcodeInput = document.getElementById('barcode-input');
  const addButton = document.getElementById('add-barcode');
  const scannedItems = document.getElementById('scanned-items');
  const updateButton = document.getElementById('update-button');
  const resetButton = document.getElementById('reset-button');
  const locationSelect = document.getElementById('location-select');
  const sublocationSelect = document.getElementById('sublocation-select');

  let scannedBarcodes = [];

  function showEmptyState() {
    scannedItems.innerHTML = `
      <tr id="empty-state">
        <td colspan="2" class="empty-state">
          <div class="barcode-icon">||||</div>
          <div class="empty-state-title">No scanned samples</div>
          <div class="empty-state-text">This table will automatically populate with samples as they are scanned or entered manually in the input field above.</div>
        </td>
      </tr>`;
  }

  function rowTemplate(barcode){
    return `
      <tr data-barcode="${barcode}">
        <td>${barcode}</td>
      </tr>`;
  }
  
  function addBarcode() {
    const barcode = barcodeInput.value.trim();
    if (!barcode || scannedBarcodes.includes(barcode)) {
        barcodeInput.value = '';
        return;
    };
    scannedBarcodes.push(barcode);
    document.getElementById('empty-state')?.remove();
    scannedItems.insertAdjacentHTML('beforeend', rowTemplate(barcode));
    barcodeInput.value = '';
    barcodeInput.focus();
    refreshUpdateState();
  }
  
  function refreshUpdateState() {
    const enabled = scannedBarcodes.length > 0 && !!locationSelect.value;
    updateButton.disabled = !enabled;
  }

  addButton.addEventListener('click', addBarcode);
  barcodeInput.addEventListener('keypress', e => { if (e.key === 'Enter') addBarcode(); });
  locationSelect.addEventListener('change', refreshUpdateState);
  
  resetButton.addEventListener('click', () => {
    scannedBarcodes = [];
    showEmptyState();
    locationSelect.value = '';
    sublocationSelect.value = '';
    sublocationSelect.disabled = true;
    refreshUpdateState();
    barcodeInput.focus();
  });
  
  // Initialization
  showEmptyState();
});
</script>
{% endblock %}
